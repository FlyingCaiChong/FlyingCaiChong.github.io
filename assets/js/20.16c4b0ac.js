(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{293:function(t,s,e){"use strict";e.r(s);var a=e(10),v=Object(a.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"husky-的使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#husky-的使用"}},[t._v("#")]),t._v(" Husky 的使用 💉")]),t._v(" "),s("p",[t._v("虽然我们已经要求项目使用"),s("code",[t._v("eslint")]),t._v("了, 但是不能保证组员提交代码之前都将"),s("code",[t._v("eslint")]),t._v("中的问题解决掉:")]),t._v(" "),s("ul",[s("li",[t._v("也就是我们希望保证代码仓库中的代码都是符合"),s("code",[t._v("eslint")]),t._v("规范的;")]),t._v(" "),s("li",[t._v("那么我们需要在组员执行"),s("code",[t._v("git commit")]),t._v("命令的时候对其进行校验, 如果不符合"),s("code",[t._v("eslint")]),t._v("规范, 那么自动通过规范进行修复;\n那么如何做到这一点呢? 可以通过"),s("code",[t._v("Husky")]),t._v("工具:")]),t._v(" "),s("li",[s("code",[t._v("husky")]),t._v("是一个"),s("code",[t._v("git hook")]),t._v("工具, 可以帮助我们触发"),s("code",[t._v("git")]),t._v("提交的各个阶段: "),s("code",[t._v("pre-commit")]),t._v("、"),s("code",[t._v("commit-msg")]),t._v("、"),s("code",[t._v("pre-push")])])]),t._v(" "),s("p",[t._v("如何使用"),s("code",[t._v("husky")]),t._v("?\n可以使用自动配置命令:")]),t._v(" "),s("div",{staticClass:"language-sh line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("npx husky-init "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[t._v("这里会做三件事:")]),t._v(" "),s("ol",[s("li",[t._v("安装 husky 相关的依赖:\n"),s("img",{attrs:{src:"/assets//husky_01.jpg",alt:""}})]),t._v(" "),s("li",[t._v("在项目目录下创建"),s("code",[t._v(".husky")]),t._v("文件夹:\n"),s("img",{attrs:{src:"/assets//husky_02.jpg",alt:""}})]),t._v(" "),s("li",[t._v("在 package.json 中添加一个脚本:\n"),s("img",{attrs:{src:"/assets//husky_04.jpg",alt:""}})])]),t._v(" "),s("p",[t._v("接下来需要去完成一个操作, 在进行"),s("code",[t._v("commit")]),t._v("时, 执行"),s("code",[t._v("lint")]),t._v("脚本\n"),s("img",{attrs:{src:"/assets//husky_04.jpg",alt:""}})]),t._v(" "),s("h4",{attrs:{id:"代码提交风格"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#代码提交风格"}},[t._v("#")]),t._v(" 代码提交风格")]),t._v(" "),s("p",[t._v("通常我们的"),s("code",[t._v("git commit")]),t._v("会按照统一的风格来提交, 这样可以快速定位每次提交的内容, 方便之后对版本进行控制\n"),s("img",{attrs:{src:"/assets//husky_05.jpg",alt:""}}),t._v("\n但是如果每次手动来编写这些事比较麻烦的事情, 我们可以使用一个工具: "),s("code",[t._v("Commitizen")])]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("Commitizen")]),t._v("是一个帮助我们编写规范"),s("code",[t._v("commit message")]),t._v("的工具")])]),t._v(" "),s("ol",[s("li",[t._v("安装"),s("code",[t._v("Commitizen")]),s("div",{staticClass:"language-sh line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" commitizen "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-D")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])])]),t._v(" "),s("li",[t._v("安装"),s("code",[t._v("cz-conventional-changelog")]),t._v(", 并且初始化"),s("code",[t._v("cz-conventional-changelog")]),t._v(":"),s("div",{staticClass:"language-sh line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v(" npx commitizen init cz-conventional-changelog --save-dev --save-exact\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),t._v("这个命令会帮助我们安装"),s("code",[t._v("cz-conventional-changelog")]),t._v(":\n"),s("img",{attrs:{src:"/assets//husky_06.jpg",alt:""}}),t._v("\n并且在 package.json 中进行配置:\n"),s("img",{attrs:{src:"/assets//husky_07.jpg",alt:""}})])]),t._v(" "),s("p",[t._v("这个时候我们提交代码需要使用"),s("code",[t._v("npx cz")]),t._v("\n第一步选择 type, 本次更新的类型")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("Type")]),t._v(" "),s("th",[t._v("作用")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("feat")]),t._v(" "),s("td",[t._v("新增特性(feature)")])]),t._v(" "),s("tr",[s("td",[t._v("fix")]),t._v(" "),s("td",[t._v("修复 Bug(bug fix)")])]),t._v(" "),s("tr",[s("td",[t._v("docs")]),t._v(" "),s("td",[t._v("修改文档(documentation)")])]),t._v(" "),s("tr",[s("td",[t._v("style")]),t._v(" "),s("td",[t._v("代码格式修改(white-space, formatting, missing semi colons, etc)")])]),t._v(" "),s("tr",[s("td",[t._v("refactor")]),t._v(" "),s("td",[t._v("代码重构(refactor)")])]),t._v(" "),s("tr",[s("td",[t._v("perf")]),t._v(" "),s("td",[t._v("改善性能(A code change that improves performance)")])]),t._v(" "),s("tr",[s("td",[t._v("test")]),t._v(" "),s("td",[t._v("测试(when adding missing tests)")])]),t._v(" "),s("tr",[s("td",[t._v("build")]),t._v(" "),s("td",[t._v("变更项目构建或外部依赖(例如 Scopes: webpack,gulp,npm 等)")])]),t._v(" "),s("tr",[s("td",[t._v("ci")]),t._v(" "),s("td",[t._v("更改持续集成软件的配置文件和.package 中的 scripts 命令, 例如 scopes: Travis, Circle 等")])]),t._v(" "),s("tr",[s("td",[t._v("chore")]),t._v(" "),s("td",[t._v("变更构建流程或辅助工具(比如更改测试环境)")])]),t._v(" "),s("tr",[s("td",[t._v("revert")]),t._v(" "),s("td",[t._v("代码回退")])])])]),t._v(" "),s("h4",{attrs:{id:"代码提交验证"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#代码提交验证"}},[t._v("#")]),t._v(" 代码提交验证")]),t._v(" "),s("p",[t._v("如果我们安装"),s("code",[t._v("cz")]),t._v("来规范了提交风格,但是依然有同事通过"),s("code",[t._v("git commit")]),t._v("按照不规范的格式提交应该怎么办呢?\n我们可以通过"),s("code",[t._v("commitline")]),t._v("来限制提交:")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("安装 "),s("code",[t._v("@commitlint/config-conventional")]),t._v("和 "),s("code",[t._v("@commitlint/cli")])]),t._v(" "),s("div",{staticClass:"language-sh line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" i @commitlint/config-conventional @commitlint/cli "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-D")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])])]),t._v(" "),s("li",[s("p",[t._v("在根目录创建"),s("code",[t._v("commitlint.config.js")]),t._v("文件,配置"),s("code",[t._v("commitlint")])]),t._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("module"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"@commitlint/config-conventional"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br")])])]),t._v(" "),s("li",[s("p",[t._v("使用"),s("code",[t._v("husky")]),t._v("生成"),s("code",[t._v("commit-msg")]),t._v("文件,验证提交信息")]),t._v(" "),s("div",{staticClass:"language-sh line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("npx husky "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),t._v(" .husky/commit-msg "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"npx --no-install commitlint --edit '),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$1")]),t._v('"')]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])])])])])}),[],!1,null,null,null);s.default=v.exports}}]);